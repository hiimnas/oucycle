<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OUCycle Â· Rides</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./q2ab.css" />
  </head>
  <body>
    <header>
      <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
          <a class="navbar-brand" href="index.html"
            ><img src="./logo.png" alt
          /></a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul
              class="navbar-nav ms-lg-auto py-4 py-lg-0 text-center text-lg-left"
            >
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="index.html"
                  >Home</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="q2ab.html">Rides</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="Events.html">Events</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="Member.html">Members</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="News.html">News</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="Announcements.html">Announcements</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>
    <div class="main">
      <div class="container">
        <div class="inner">
          <h1 class="page-title">Rides</h1>
          <div class="row gx-2 gy-3">
            <div class="col-12">
              <div class="card-wrapper">
                <div class="head">
                  <h2>Add New Ride</h2>
                </div>
                <div class="inner-card-wrapper">
                  <form id="rideForm">
                  <input type="hidden" id="rideKey" />
                  <input type="hidden" name="SessionIdentifier" id="sessionIdentifier" value="ff53-dd45-dcba9876-9090" />
                  <div class="row">
                    <div class="col-lg-3 col-md-4 col-sm-6">
                      <div class="field-wrapper d-flex flex-column">
                        <label for="rideName">Name of Ride</label>
                        <input type="text" id="rideName" class="form-control" required />
                      </div>
                      <div class="field-wrapper d-flex flex-column mt-3">
                        <label for="rideType">Type of Ride</label>
                        <input type="text" id="rideType" class="form-control" required />
                      </div>
                      <div class="field-wrapper d-flex flex-column mt-3">
                        <label for="rideDate">Date of Ride</label>
                        <input type="date" id="rideDate" class="form-control" required />
                      </div>
                      <div class="field-wrapper d-flex flex-column mt-3">
                        <label for="startTime">Start Time</label>
                        <input type="time" id="startTime" class="form-control" required />
                      </div>
                      <div class="field-wrapper d-flex flex-column mt-3">
                        <label for="duration">Duration</label>
                        <div class="input-group">
                          <input type="number" id="duration" class="form-control" required />
                          <div class="input-group-append">
                            <span class="input-group-text">mins</span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-6">
                      <div class="field-wrapper d-flex flex-column">
                        <label for="meetingPoint">Meeting Point</label>
                        <input type="text" id="meetingPoint" class="form-control" required />
                      </div>
                      <div class="field-wrapper d-flex flex-column mt-3">
                        <label for="distance">Distance</label>
                        <div class="input-group">
                          <input type="number" id="distance" class="form-control" required />
                          <div class="input-group-append">
                            <span class="input-group-text">km</span>
                          </div>
                        </div>
                      </div>
                      <div class="field-wrapper d-flex flex-column mt-3">
                        <label for="elevation">Elevation</label>
                        <div class="input-group">
                          <input type="number" id="elevation" class="form-control" required />
                          <div class="input-group-append">
                            <span class="input-group-text">m</span>
                          </div>
                        </div>
                      </div>
                      <div class="field-wrapper d-flex flex-column mt-3">
                        <label for="maxGroupSize">Maximum group size</label>
                        <div class="input-group">
                          <input type="number" id="maxGroupSize" class="form-control" required />
                          <div class="input-group-append">
                            <span class="input-group-text">people</span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-6">
                      <div class="field-wrapper d-flex flex-column">
                        <label for="leaderName">Name of leader</label>
                        <input type="text" id="leaderName" class="form-control" required />
                      </div>
                      <div class="field-wrapper d-flex flex-column mt-3">
                        <label for="primaryContact"
                          >Primary contact number</label
                        >
                        <input type="tel" id="primaryContact" class="form-control" required />
                      </div>
                      <div class="field-wrapper d-flex flex-column mt-3">
                        <label for="secondaryContact"
                          >Secondary contact number</label
                        >
                        <input type="tel" id="secondaryContact" class="form-control" />
                      </div>
                    </div>
                    <div class="col-lg-3 col-md-12">
                      <div
                        class="field-wrapper d-flex flex-column mt-3 mt-md-0"
                      >
                        <label for="comments">Comments</label>
                        <textarea id="comments" class="form-control" rows="5"></textarea>
                      </div>
                    </div>
                  </div>
                  <button type="submit" class="more-cta">Submit</button>
                </form>
              </div>
            </div>
            <div class="card-wrapper mt-3">
              <div class="head">
                <h2>Existing Rides</h2>
              </div>
              <!-- <div
                id="carouselExampleIndicators"
                class="carousel slide pb-2"
                data-bs-ride="carousel"
              > -->
              <div class="carousel-indicators">
                <!-- Indicators will be generated by JavaScript -->
              </div>
              <div class="carousel-inner">
                <!-- Ride data will be inserted here by JavaScript -->
              </div>
			  </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>

    <script>
      function deleteIT(key) {
        localStorage.removeItem(key);
        displayRides();
      }

      function displayRides() {
        const ridesContainer = document.querySelector(".carousel-inner");
        const indicatorsContainer = document.querySelector(
          ".carousel-indicators"
        );

        // Clear current rides
        ridesContainer.innerHTML = "";
        indicatorsContainer.innerHTML = "";

        // Get all rides from local storage
        const rides = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key.startsWith("ride_")) {
            const ride = JSON.parse(localStorage.getItem(key));
            rides.push({ key, ...ride });
          }
        }

        // Sort rides by key (timestamp)
        rides.sort((a, b) => a.key.localeCompare(b.key));

        // Display rides
        rides.forEach((ride, index) => {
          const activeClass = index === 0 ? "active" : "";
          let statusClass;
          switch (ride.status) {
            case "approved":
              statusClass = "approved";
              break;
            case "rejected":
              statusClass = "cancelled";
              break;
            case "proposed":
            default:
              statusClass = "proposed";
              break;
          }

          ridesContainer.innerHTML += `
          <div class="inner-card-wrapper">
            <div class="bordered-card-item">
              <div class="details-head d-flex justify-content-between">
                <div class="d-flex flex-column align-items-start">
                  <h3>${ride.rideName}</h3>
                  <p>Meet at ${ride.meetingPoint}</p>
                  <span>Type: ${ride.rideType}</span>
                </div>
                <div class="edit d-flex align-items-start">
                  <div class="d-flex flex-column align-items-end">
                    <span>${ride.rideDate}, ${ride.startTime}</span>
                    <span>${ride.distance} km for ${ride.duration} mins</span>
                    <span class="status ${statusClass} mt-1" data-key="${
            ride.key
          }" data-bs-toggle="modal" data-bs-target="#statusModal">${
            statusClass == "cancelled"
              ? "Rejected"
              : statusClass.charAt(0).toUpperCase() + statusClass.slice(1)
          }</span>
                  </div>
                  <span class="status edit"><i class="text-light fa-solid fa-pen-to-square" data-key="${
                    ride.key
                  }" id="editRide"></i></span>

                  <span class="status edit"><i class="text-light fa-solid fa-trash" onclick="deleteIT('${
                    ride.key
                  }')"></i></span>
                </div>
              </div>
              <div class="content column-details">
                <div class="d-flex align-items-start mt-2">
                  <span class="small">Comments</span>
                  <p>${ride.comments}</p>
                </div>
                <div class="d-flex align-items-start mt-2">
                  <span class="small">Leader</span>
                  <p class="small"><span class="small bolder">${
                    ride.leaderName
                  }</span> Primary: ${ride.primaryContact}, Secondary: ${
            ride.secondaryContact
          }</p>
                </div>
                <div class="d-flex align-items-start mt-2">
                  <span class="small">Extra</span>
                  <p class="small">Elevation: ${
                    ride.elevation
                  } m<br>Maximum Group Size: ${ride.maxGroupSize}</p>
                </div>
              </div>
            </div>
          </div>
      `;
        });

        // Add event listeners for status elements
        document
          .querySelectorAll(".status[data-bs-toggle='modal']")
          .forEach((element) => {
            element.addEventListener("click", function () {
              const key = this.getAttribute("data-key");
              document
                .getElementById("statusModal")
                .setAttribute("data-key", key);
              const ride = JSON.parse(localStorage.getItem(key));
              document.getElementById("statusSelect").value =
                ride.status || "proposed";
            });
          });

        // Add event listeners for edit icons
        document.querySelectorAll("#editRide").forEach((element) => {
          element.addEventListener("click", function () {
            const key = this.getAttribute("data-key");
            const ride = JSON.parse(localStorage.getItem(key));
            document.getElementById("rideKey").value = key;
            document.getElementById("rideName").value = ride.rideName;
            document.getElementById("rideType").value = ride.rideType;
            document.getElementById("rideDate").value = ride.rideDate;
            document.getElementById("startTime").value = ride.startTime;
            document.getElementById("duration").value = ride.duration;
            document.getElementById("meetingPoint").value = ride.meetingPoint;
            document.getElementById("distance").value = ride.distance;
            document.getElementById("elevation").value = ride.elevation;
            document.getElementById("maxGroupSize").value = ride.maxGroupSize;
            document.getElementById("leaderName").value = ride.leaderName;
            document.getElementById("primaryContact").value =
              ride.primaryContact;
            document.getElementById("secondaryContact").value =
              ride.secondaryContact;
            document.getElementById("comments").value = ride.comments;
          });
        });
      }

      document.addEventListener("DOMContentLoaded", function () {
        // Display rides on initial load
        displayRides();

        // Add event listener for the save button in the modal
        document
          .getElementById("saveStatusBtn")
          .addEventListener("click", saveStatus);

        // Function to display rides

        // Function to save the status
        function saveStatus() {
          const statusSelect = document.getElementById("statusSelect");
          const selectedStatus = statusSelect.value;
          const statusKey = document
            .getElementById("statusModal")
            .getAttribute("data-key");

          const ride = JSON.parse(localStorage.getItem(statusKey));
          ride.status = selectedStatus;
          localStorage.setItem(statusKey, JSON.stringify(ride));

          // Close the modal
          const statusModal = bootstrap.Modal.getInstance(
            document.getElementById("statusModal")
          );
          statusModal.hide();

          // Update the display
          displayRides();
        }

        // Form submit handler
        document
          .getElementById("rideForm")
          .addEventListener("submit", function (event) {
            event.preventDefault();

            const rideData = {
              rideName: document.getElementById("rideName").value,
              rideType: document.getElementById("rideType").value,
              rideDate: document.getElementById("rideDate").value,
              startTime: document.getElementById("startTime").value,
              duration: document.getElementById("duration").value,
              meetingPoint: document.getElementById("meetingPoint").value,
              distance: document.getElementById("distance").value,
              elevation: document.getElementById("elevation").value,
              maxGroupSize: document.getElementById("maxGroupSize").value,
              leaderName: document.getElementById("leaderName").value,
              primaryContact: document.getElementById("primaryContact").value,
              secondaryContact:
                document.getElementById("secondaryContact").value,
              comments: document.getElementById("comments").value,
              status: "proposed", // Default status
            };

            const rideKey = document.getElementById("rideKey").value;
            if (rideKey) {
              localStorage.setItem(rideKey, JSON.stringify(rideData));
            } else {
              const uniqueKey = "ride_" + new Date().getTime();
              localStorage.setItem(uniqueKey, JSON.stringify(rideData));
            }

            document.getElementById("rideForm").reset();
            displayRides();
            alert("Data stored successfully!");
          });
      });
    </script>

    <!-- Status Modal -->
    <div
      class="modal fade"
      id="statusModal"
      tabindex="-1"
      aria-labelledby="statusModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="statusModalLabel">
              Change Ride Status
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <select id="statusSelect" class="form-select">
              <option value="proposed">Proposed (Yellow)</option>
              <option value="approved">Approved (Green)</option>
              <option value="rejected">Rejected (Red)</option>
            </select>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button type="button" class="btn btn-primary" id="saveStatusBtn">
              Save changes
            </button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
